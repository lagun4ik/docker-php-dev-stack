version: '2'

services:
  nginx:
    restart: always
    image: lagun4ik/nginx-pagespeed
    env_file: docker-compose.env
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./data/letsencrypt:/var/letsencrypt
      - ./data/nginx/sites-enabled:/etc/nginx/sites-enabled
      - ./data/nginx/ngx_pagespeed:/var/cache/ngx_pagespeed
      - ./data/www/:/var/www/
      - /etc/localtime:/etc/localtime:ro

  letsencrypt:
    restart: always
    image: lagun4ik/letsencrypt-webroot
    env_file: docker-compose.env
    volumes:
      - ./data/letsencrypt/conf:/etc/letsencrypt
      - ./data/letsencrypt/www:/tmp/letsencrypt
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock

  php:
    image: lagun4ik/php7-fpm:dev
    env_file: docker-compose.env
    restart: always
    volumes:
      - ./data/www/:/var/www/

  mysql:
    image: mariadb
    env_file: docker-compose.env
    restart: always
    volumes:
        - ./data/mysql/:/var/lib/mysql/

  memcached:
    image: memcached:alpine
    restart: always
    mem_limit: 100m

  redis:
    image: redis:alpine
    restart: always
    mem_limit: 100m
