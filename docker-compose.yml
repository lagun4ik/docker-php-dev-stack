data:
    image: 'busybox'
    tty: true
    container_name: 'data'
    volumes:
      - './data/www/:/var/www/'
      - './data/mongo/:/data/db/'
      - './data/mysql/:/var/lib/mysql/'
      - './data/nginx/:/etc/nginx/sites-enabled/'
      - './data/ssl/:/etc/nginx/ssl/'
      - './data/letsencrypt/live/:/etc/letsencrypt/live'
      - './data/letsencrypt/archive/:/etc/letsencrypt/archive'
      - './data/letsencrypt/domains.json:/domains.json'

nginx:
    image: 'lagun4ik/docker-nginx-pagespeed:alpine'
    restart: 'always'
    links:
        - 'php-fpm'
    ports:
        - '80:80'
        - '443:443'
    volumes_from:
        - 'data'

letsencrypt:
    image: 'lagun4ik/docker-letsencrypt'
    restart: 'always'
    volumes_from:
        - 'data'

php-fpm:
    image: 'lagun4ik/docker-php7-fpm'
    restart: always
    links:
        - 'mysql'
        - 'mongo'
        - 'memcached'
        - 'redis'
    expose:
        - '9000'
    volumes_from:
        - 'data'
    environment:
      PHP_INI_TYPE: production

mongo:
    image: mongo
    restart: 'always'
    volumes_from:
        - 'data'
    expose:
      - "27017"

mysql:
    image: mariadb
    restart: 'always'
    volumes_from:
        - 'data'
    expose:
      - "3306"
    environment:
      MYSQL_ROOT_PASSWORD: password

memcached:
    image: memcached:alpine
    restart: 'always'
    mem_limit: 100m
    expose:
      - "11211"

redis:
    image: redis:alpine
    restart: 'always'
    mem_limit: 100m
    expose:
      - "6379"
